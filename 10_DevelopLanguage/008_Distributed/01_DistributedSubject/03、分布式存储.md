###### 1. 什么是分布式文件系统？
分布式文件系统是指文件系统管理的物理存储资源不一定直接连接在本地节点，而是通过计算机网络与节点相连，形成统一的逻辑文件系统。其核心设计目标是**提供单一逻辑视图**，使用户能够像访问本地文件系统一样访问分布在网络上的文件。
**核心特性与Java开发视角**：
- **透明性**：包括访问透明性（远程文件与本地文件操作方式一致）、位置透明性（文件物理位置对用户隐藏）。在Java中，通过HDFS的`FileSystem`抽象类，使用`get(URI uri, Configuration conf)`方法获取文件系统实例，代码层面无需关心底层是本地文件系统还是HDFS。
- **并发控制**：解决多客户端同时访问同一文件的问题。策略包括：
    - **只读共享**：简单实现，适用于静态资源。
    - **受控写操作**：允许多用户打开文件，但仅限一个用户修改。
    - **并发写操作**：需复杂锁机制，如HDFS的租约机制（Lease），确保同一时刻只有一个客户端能写入特定文件块。
- **容错与冗余**：通过数据复制（如HDFS默认3副本）或纠删码技术，确保部分节点故障时数据不丢失且服务持续。其冗余机制（如多副本或纠删码）和容错设计使得即使部分节点失效，系统仍能运行且数据可恢复。
###### 2. HDFS 的架构和工作原理是什么？
HDFS采用**主从（Master-Slave）架构**，核心组件包括NameNode、DataNode和Secondary NameNode。

|**组件**​|**角色**​|**关键职责**​|**Java实现要点**​|
|---|---|---|---|
|**NameNode**​|主节点|管理文件系统命名空间（元数据：文件名、权限、文件块映射）。监控DataNode心跳与块报告。|元数据常驻内存（`FSImage`文件保存快照，`EditLog`记录操作）。源码中`FSNamesystem`类管理大部分元数据。|
|**DataNode**​|从节点|存储实际数据块。执行客户端读写请求，定期向NameNode发送心跳和块报告。|通过`DataNode`类实现，每个数据块以独立文件存储于本地磁盘。|
|**Secondary NameNode**​|辅助节点|定期合并`FSImage`和`EditLog`，生成新元数据快照，减轻NameNode负担**（非热备）**。|`SecondaryNameNode`类执行检查点过程。|
**工作原理深度解析**：
- **文件写入（Pipeline机制）**：
    1. 客户端调用`FileSystem.create()`方法，向NameNode申请写入文件。
    2. NameNode校验权限后，在元数据中创建文件记录，并返回一组适合写入的DataNode列表（管道）。
    3. 客户端将数据分割成数据包（packet），流式写入管道的第一个DataNode。
    4. 第一个DataNode接收数据并存储，同时将数据包转发给管道中的下一个DataNode，依次传递，形成流水线。
    5. 管道中最后一个DataNode完成存储后，沿管道反向发送确认信号。客户端收到最终确认后，完成写入。此机制通过网络并行化大幅提升写入吞吐量。
- **文件读取**：
    1. 客户端调用`FileSystem.open()`方法，向NameNode获取文件块位置信息。
    2. NameNode返回存有该文件各块副本的DataNode地址（按网络拓扑就近原则排序）。
    3. 客户端直接连接到最近的DataNode，并行读取数据块，最后在本地按偏移量合并成完整文件。
- **容错机制**：
    - **数据块副本**：NameNode定期接收DataNode块报告。若发现某块副本数低于设定值，会触发复制流程，将块复制到其他健康DataNode。
    - **重新平衡**：HDFS提供`balancer`工具，均衡集群各节点磁盘使用率。
###### 3. 什么是对象存储？
对象存储是一种以**对象**为基本存储单元的分布式存储架构。每个对象包含**数据本身、元数据（描述数据的属性）和全局唯一的标识符**。它通过**RESTful API（如HTTP PUT/GET/DELETE）**​ 进行访问，非常适合存储海量的非结构化数据。
**核心特征与Java访问**：
- **扁平命名空间**：使用桶（Bucket）组织对象，无复杂目录层级，易于扩展。
- **丰富的元数据**：每个对象可携带自定义元数据，便于数据管理。
- **Java访问示例**：使用AWS S3 Java SDK。
    ```java
    // 创建S3客户端
    AmazonS3 s3Client = AmazonS3ClientBuilder.standard().withRegion(Regions.US_EAST_1).build();
    // 上传一个对象
    s3Client.putObject("my-bucket", "path/to/myfile.txt", new File("/local/path/myfile.txt"));
    ```
###### 4. 什么是块存储和文件存储的区别？

|**特征**​|**块存储**​|**文件存储**​|
|---|---|---|
|**访问接口**​|底层块设备协议（如iSCSI），提供原始磁盘块。|文件级协议（如NFS, SMB/CIFS），提供文件目录树。|
|**数据组织**​|未格式化的裸块，由操作系统格式化。|有层次的文件和目录结构。|
|**典型场景**​|数据库、需要高IOPS低延迟的核心应用。|文件共享、NAS、企业文档管理。|
|**优势**​|高性能、低延迟。|易于共享、管理，具备文件级权限控制。|
**对象存储**可视为两者的结合与演进，它通过HTTP接口提供类似文件存储的数据组织逻辑，但底层数据管理更灵活，具备块存储的某些扩展性优势。
###### 5. 分布式存储系统如何保证数据的可靠性？
数据可靠性主要通过**冗余机制**和**故障恢复**来实现。
1. **多副本机制（Replication）**：
    - **原理**：将同一份数据复制成多个副本（通常3个），存储在不同节点、机架甚至数据中心。
    - **实现**：如HDFS的管道写入机制。当某个副本所在节点宕机，系统会自动从健康副本复制数据到新节点，使副本数恢复正常。
2. **纠删码（Erasure Coding）**：
    - **原理**：一种更节省存储空间的冗余技术。将原始数据分割成`k`个数据块，并通过编码计算生成`m`个校验块，总共得到`n = k + m`个块。只要剩余可用块数不少于`k`，即可恢复全部原始数据。例如，EC 10/16配置中，10个数据块生成6个校验块，最多可容忍6个块失效。
    - **优势**：存储效率高。要达到同样级别的容错能力，纠删码的存储开销远低于多副本。
    - **权衡**：编码解码需要计算资源，通常适用于访问频率较低的冷数据。
3. **数据一致性协议**：
    - 如Paxos、Raft算法，用于在多个副本间保证数据的强一致性，确保在分布式环境下对数据的更新操作在所有副本上以相同的顺序执行。
###### 6. 什么是副本机制？
副本机制是分布式存储系统中最基础、最直接的**数据冗余**技术，通过主动复制数据副本来提高数据的**可用性**和**可靠性**。
- **核心目标**：
    - **高可用**：某个副本不可用时，可由其他副本继续提供服务。
    - **负载均衡**：读请求可被分发到不同副本，提升读取吞吐量。
    - **容错**：物理硬件故障时，数据不丢失。
- **挑战**：
    - **一致性**：如何保证多个副本的数据在更新时保持一致是核心挑战，需权衡强一致性（如WARO）和最终一致性。
    - **存储开销**：副本数越多，可靠性越高，但存储成本也线性增长。
###### 7. 什么是纠删码（Erasure Code）？
纠删码是一种基于编码理论的数据保护技术，核心目标是**以更低的存储开销实现与多副本机制相当或更高的数据可靠性**。
- **工作原理（以里德-所罗门码为例）**：
    1. **编码**：将原始数据分割成`k`个数据块，通过数学变换（如范德蒙矩阵运算）生成`m`个校验块，得到`n = k + m`个数据块。
    2. **存储**：将这`n`个块分散存储在不同的存储节点上。
    3. **解码与恢复**：当部分块（最多`m`个）丢失或损坏时，只要能从剩余的块中成功获取任意`k`个有效块，就可以通过解码算法完全恢复出原始的`k`个数据块。
- **在HDFS中的应用**：HDFS支持纠删码策略。对于冷数据，可将其从3副本策略转换为纠删码策略（如RS-6-3），存储开销从300%降低到150%，同时保持可容忍3个块故障的能力。
###### 8. 分布式存储中的数据分片策略有哪些？
数据分片是将大型数据集划分为更小、更易管理的部分，并分布到多个存储节点上的关键技术，是实现**水平扩展**和**并行处理**的基础。
1. **固定大小分块（Fixed-Size Chunking）**：
    - **描述**：将文件按固定大小（如HDFS的64MB/128MB）切割成块。
    - **优点**：实现简单，易于管理，元数据规模固定。
    - **缺点**：对文件中间部分的小量修改可能导致大量块无效，即“分片边界敏感”。
2. **基于内容的可变分块（Content-Defined Chunking）**：
    - **描述**：使用滑动窗口和哈希函数（如Rabin指纹）动态确定分块边界。当窗口内数据的哈希值满足特定条件（如模运算为特定值）时，即认为是一个分块边界。
    - **优点**：对文件内容的插入和删除操作有很好的适应性，能最大限度减少因局部修改导致的重复数据存储（重删效果好）。
    - **缺点**：计算开销较大，块大小不固定，管理更复杂。
3. **对象/键分片（Object/Key Partitioning）**：
    - **描述**：常见于对象存储和NoSQL数据库。使用对象名或键（Key）的哈希值（如一致性哈希）来决定数据存储在哪个节点。
    - **优点**：分布均匀，易于扩展。